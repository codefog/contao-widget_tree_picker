var TreePicker={selectParents:function(b){if(b.checked===false){return}function a(d){var c=d.getParent("ul").getParent().getPrevious("li").getElement('input[type="checkbox"]');if(c===null){return}c.checked=true;a(c)}a(b)},toggle:function(b,g,e,a,f){b.blur();Backend.getScrollOffset();var c=$(g),d=$(b).getFirst("img");if(c){if(c.getStyle("display")=="none"){c.setStyle("display","inline");d.src=d.src.replace("folPlus.gif","folMinus.gif");$(b).store("tip:title",Contao.lang.collapse);new Request.Contao({field:b}).post({action:"toggleTreepicker",id:g,state:1,REQUEST_TOKEN:Contao.request_token})}else{c.setStyle("display","none");d.src=d.src.replace("folMinus.gif","folPlus.gif");$(b).store("tip:title",Contao.lang.expand);new Request.Contao({field:b}).post({action:"toggleTreepicker",id:g,state:0,REQUEST_TOKEN:Contao.request_token})}return false}new Request.Contao({field:b,evalScripts:true,onRequest:AjaxRequest.displayBox(Contao.lang.loading+" …"),onSuccess:function(i){var h=new Element("li",{id:g,"class":"parent",styles:{display:"inline"}});var j=new Element("ul",{"class":"level_"+f,html:i}).inject(h,"bottom");h.inject($(b).getParent("li"),"after");h.getElements("a").each(function(k){k.href=k.href.replace(/&ref=[a-f0-9]+/,"&ref="+Contao.referer_id)});$(b).store("tip:title",Contao.lang.collapse);d.src=d.src.replace("folPlus.gif","folMinus.gif");AjaxRequest.hideBox();window.fireEvent("ajax_change")}}).post({action:"loadTreepicker",id:g,level:f,field:e,name:a,state:1,REQUEST_TOKEN:Contao.request_token});return false},openModal:function(b){var c=b||{},a=(window.getSize().y-180).toInt();if(!c.height||c.height>a){c.height=a}var d=new SimpleModal({width:c.width,btn_ok:Contao.lang.close,draggable:false,overlayOpacity:0.5,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){document.body.setStyle("overflow","auto")}});d.addButton(Contao.lang.close,"btn",function(){this.hide()});d.addButton(Contao.lang.apply,"btn primary",function(){var j=[],h=null,e=window.frames;for(f=0;f<e.length;f++){if(e[f].name=="simple-modal-iframe"){h=e[f];break}}if(h===null){alert("Could not find the SimpleModal frame");return}if(h.document.location.href.indexOf("contao/main.php")!=-1){alert(Contao.lang.picker);return}var g=h.document.getElementById("tl_select").getElementsByTagName("input");for(var f=0;f<g.length;f++){if(!g[f].checked||g[f].id.match(/^check_all_/)){continue}if(!g[f].id.match(/^reset_/)){j.push(g[f].get("value"))}}if(c.tag){$(c.tag).value=j.join(",");c.self.set("href",c.self.get("href").replace(/&value=[^&]*/,"&value="+j.join(",")))}else{$("ctrl_"+c.id).value=j.join("\t");new Request.Contao({field:$("ctrl_"+c.id),evalScripts:false,onRequest:AjaxRequest.displayBox(Contao.lang.loading+" …"),onSuccess:function(i,k){$("ctrl_"+c.id).getParent("div").set("html",k.content);k.javascript&&Browser.exec(k.javascript);AjaxRequest.hideBox();window.fireEvent("ajax_change")}}).post({action:"reloadTreepicker",name:c.id,value:$("ctrl_"+c.id).value,REQUEST_TOKEN:Contao.request_token})}this.hide()});d.show({title:c.title,contents:'<iframe src="'+c.url+'" name="simple-modal-iframe" width="100%" height="'+c.height+'" frameborder="0"></iframe>',model:"modal"})},};